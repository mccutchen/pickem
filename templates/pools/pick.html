{% extends "3columns.html" %}

{% block page_header %}
    <h1><label>Pool:</label> {{ pool }}</h1>
{% endblock %}

{% block left %}
    {% include "pools/_left.html" %}
{% endblock %}

{% block middle %}
    <div id="current-week" class="week">
        <h2><span>Picking:</span> {{ week }}</h2>
        {% if entry.has_picked(week) %}
            <h3 class="pick"><span>Your pick:</span> {{ pick }}</h3>
        {% endif %}
        <h3>
            {% if week.started %}
                Finished.
            {% else %}
                Deadline: {{ week.start|dateformat('%A, %B %d at %I:%M') }}
            {% endif %}
        </h3>
        <form action="{{ url('pick', pool|id, entry|id, week|id) }}" method="post">
            <table class="games">
                {% set last_kickoff = None %}
                {% for date, group in week.grouped_games %}
                    <th class="date" colspan="5">{{ date|dateformat('%A, %B %d') }}</th>
                    {% for game in group %}
                        <tr>
                            <td class="kickoff">
                                {% if not last_kickoff or last_kickoff != game.start %}
                                    {{ game.start|dateformat('%I:%M') }}
                                    {% set last_kickoff = game.start %}
                                {% endif %}
                            </td>
                            <td class="away team">
                                <label>
                                    <input type="radio" name="pick" value="{{ game.away_team|keyname }}">
                                    {{ game.away_team }}
                                </label>
                            </td>
                            <td class="away spread">{{ (game.spread * -1)|default('--', True) }}</td>
                            <td class="at">at</td>
                            <td class="home team">
                                <label>
                                    <input type="radio" name="pick" value="{{ game.home_team|keyname }}">
                                    {{ game.home_team }}
                                </label>
                            </td>
                            <td class="home spread">{{ game.spread|default('--', True) }}</td>
                        </tr>
                    {% endfor %}
                {% endfor %}
            </table>
            <input type="submit" value="Make Pick!">
        </form>
    </div>
{% endblock %}

{% block right %}
    <div id="other-weeks">
        <h3>All Picks</h3>
        {% set current_week = week %}
        {% include 'pools/_weeks.html' %}
{% endblock %}