{% extends "3columns.html" %}
{% import "macros/games.html" as games %}

{% block head %}
    {{ super() }}
    <script type="text/javascript" charset="utf-8">
        $(document).ready(function() {
            var form = $('#pick');
            form.children('div.submit').hide();
            form.find('input[type="radio"]').change(function() {
                var label = $(this).parent();
                console.log(form.attr('action'), form.attr('method'));
                $.ajax({
                    url: form.attr('action'),
                    type: form.attr('method'),
                    data: form.serialize(),
                    success: function() {
                        $('td.picked').removeClass('picked');
                        label.parent('td').addClass('picked');
                        $('#your-pick span')
                            .addClass('picked')
                            .removeClass('not')
                            .text(label.text().trim());
                    },
                    error: function() {
                        alert('Error submitting pick');
                    }
                });
            });
        });
    </script>
{% endblock %}

{% block page_header %}
    <h1><label>Pool:</label> <a href="{{ url('pool', pool|id) }}">{{ pool }}</a></h1>
{% endblock %}

{% block left %}
    {% include "pools/_left.html" %}
{% endblock %}

{% block middle %}
    <div id="current-week" class="week">
        <h2>{{ week }} <span>vs <strong>{{ pool.active_entries.count() }}</strong> competitors</span></h2>

        <p class="deadline{% if week.closed %} closed{% endif %}">
            {% if week.closed %}
                Closed.
            {% else %}
                <span>Deadline:</span> {{ week.start|timeuntil }}
            {% endif %}
        </p>

        <h3 id="your-pick">Your pick: <span class="{{ 'picked' if pick else 'not picked'}}">{{ pick|default('None', True) }}</span></h3>
        
        <form id="pick" action="{{ url('pick', pool|id, entry|id, week|id) }}" method="post">
            {{ games.showgames(week, pick) }}
            <div class="submit">
                <input type="submit" value="Make Pick!">
            </div>
        </form>
    </div>
{% endblock %}

{% block right %}
    <div id="other-weeks">
        <h3>All Picks</h3>
        {% set current_week = week %}
        {% include 'pools/_weeks.html' %}
        
        <div id="key">
            <h4>Key</h4>
            <table>
                <tr>
                    <th class="indicator picked">&#10003;</th>
                    <td>Picked</td>
                </tr>
                <tr>
                    <th class="indicator picked correct">&#10003;</th>
                    <td>Picked correctly</td>
                </tr>
                <tr>
                    <th class="indicator picked incorrect">&#10008;</th>
                    <td>Picked incorrectly</td>
                </tr>
                <tr>
                    <th class="indicator">&#10008;</th>
                    <td>Not picked</td>
                </tr>
            </table>
        </div>
    </div>
{% endblock %}