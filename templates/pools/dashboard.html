{% extends "2columns.html" %}

{% block page_header %}
    <h1>Dashboard</h1>
{% endblock %}

{% block left %}
    <h2>Welcome{% if entries or pools %} back{% endif %}, {{ request.account.first_name }}.</h2>

    <section id="your-entries">
        <h3>Your Entries</h3>
        <ul>
            {% for entry in entries %}
                {% set pool = entry.parent() %}
                {% set pick = entry.find_pick_for(week) %}
                {% set active_entries = pool.active_entries.count() %}
                <li>
                    <h4><a href="{{ url('entry', pool|id, entry|id) }}">{{ pool }}</a></h4>
                    <p class="meta">{{ active_entries }} active entr{{ active_entries|pluralize('y,ies') }}</p>
                    {% if pick %}
                        <p class="indicator positive pending meta">
                            {{ pick }} picked for <a href="{{ url('pick', pool|id, entry|id, week|id) }}">{{ week }}</a>
                        </p>
                    {% else %}
                        <p class="indicator negative pending meta">Pick due in {{ week.start|timeuntil }} for {{ week }}</p>
                    {% endif %}
                    <p class="meta money indicator {{ 'positive' if entry.paid else 'negative' }}">
                        ${{ pool.entry_fee|floatformat('-00') }}
                        {{ 'paid' if entry.paid else 'owed' }}
                        &#8594; ${{ pool.potential_pot|floatformat('-00') }} pot
                    </p>
                </li>
            {% else %}
                <p>You're not participating in any pools. Why don't you start a new one
                by filling out the form to the right?</p>
            {% endfor %}
        </ul>
    </section>

    {% if pools %}
        <h3>Your Pools</h3>
        <p>You're managing {{ pools|length }} pools.</p>

        <ul>
            {% for pool in pools %}
                <li>
                    <a href="{{ url('pool', pool|id) }}">{{ pool }}</a>
                    (<a href="{{ url('manage-pool', pool|id) }}">Manage</a>)
                </li>
            {% endfor %}
        </ul>
    {% endif %}
{% endblock %}

{% block right %}
    <h3>New Pool</h3>
    {% include 'pools/_new_pool_form.html' %}
{% endblock %}